<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Campus Rewards Dashboard - Track and claim your rewards">
    <title>Rewards Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Authentication Styles -->
    <style>
        .auth-banner {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 10px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .auth-banner.logged-in {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        }
        
        .auth-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .auth-status {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .login-btn, .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .login-btn:hover, .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .database-status {
            display: flex;
            gap: 10px;
            font-size: 12px;
        }
        
        .db-indicator {
            padding: 4px 8px;
            border-radius: 12px;
            background: rgba(255,255,255,0.2);
        }
        
        .db-indicator.connected {
            background: rgba(76, 175, 80, 0.8);
        }
        

    </style>
    
    <!-- Firebase SDK (Firestore only - Storage is paid feature) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-trophy"></i>
                <h2>Rewards Dashboard</h2>
            </div>
            <div class="nav-menu" id="nav-menu">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="#dashboard" class="nav-link active">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a href="#rewards" class="nav-link">Rewards</a>
                    </li>
                    <li class="nav-item">
                        <a href="#leaderboard" class="nav-link">Leaderboard</a>
                    </li>
                    <li class="nav-item">
                        <a href="#request" class="nav-link">Request Rewards</a>
                    </li>
                </ul>
            </div>
            <div class="nav-actions">
                <div class="user-menu" id="user-menu">
                    <div class="user-avatar" id="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-dropdown" id="user-dropdown">
                        <div class="user-info">
                            <span class="user-name">Guest User</span>
                            <span class="user-campus">No Campus</span>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="#profile" class="dropdown-item">
                            <i class="fas fa-user-cog"></i> Profile
                        </a>
                        <a href="#settings" class="dropdown-item">
                            <i class="fas fa-cog"></i> Settings
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#login" class="dropdown-item" id="auth-button">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </a>
                    </div>
                </div>
            </div>
            <div class="nav-toggle" id="nav-toggle">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <!-- Authentication Banner -->
    <div class="auth-banner" id="auth-banner">
        <div class="auth-content">
            <div class="auth-status">
                <div id="auth-user-info" style="display: none;">
                    <div class="user-avatar" id="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <span id="user-name">User</span>
                        <div class="database-status">
                            <div class="db-indicator" id="primary-db">Primary DB</div>
                        </div>
                    </div>
                </div>
                <div id="auth-guest-info">
                    <span>üåü Campus Rewards Dashboard - Public Access</span>
                </div>
            </div>
            
            <div>
                <a href="login.html" class="login-btn" id="login-link">
                    <i class="fas fa-sign-in-alt"></i> Sign In for Full Access
                </a>
                <button class="logout-btn" id="logout-btn" style="display: none;" onclick="signOut()">
                    <i class="fas fa-sign-out-alt"></i> Sign Out
                </button>
            </div>
        </div>
    </div>




    <!-- Dashboard Overview -->
    <section id="dashboard" class="dashboard">
        <div class="container">
            <div class="dashboard-header">
                <h1>Campus Rewards Dashboard</h1>
                <p>Track your progress and claim amazing rewards!</p>
            </div>
            
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="total-rewards">24</h3>
                        <p>Available Rewards</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="claimed-rewards">8</h3>
                        <p>Rewards Claimed</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="campus-rank">3rd</h3>
                        <p>Campus Ranking</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-medal"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="merit-level">Level 2</h3>
                        <p>Current Merit Level</p>
                    </div>
                </div>
            </div>

            <!-- Monthly Competition -->
            <div class="monthly-competition">
                <h2>üèÜ This Month's Competition</h2>
                <div class="competition-grid">
                    <div class="competition-card winning">
                        <div class="campus-info">
                            <h3>ü•á Pune Campus</h3>
                            <p>Leading with 1,340 points</p>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 88%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="competition-card">
                        <div class="campus-info">
                            <h3>ü•à Dharamshala Campus</h3>
                            <p>Second with 1,220 points</p>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 81%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="competition-card">
                        <div class="campus-info">
                            <h3>ü•â Raigarh Campus</h3>
                            <p>Third with 1,140 points</p>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 75%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Rewards Section -->
    <section id="rewards" class="rewards-section">
        <div class="container">
            <div class="section-header">
                <h2>Campus Rewards</h2>
                <p>Discover and claim rewards based on your campus merit level</p>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="filter-group">
                    <label for="campus-filter">Campus:</label>
                    <select id="campus-filter">
                        <option value="all">All Campuses</option>
                        <option value="pune">Pune</option>
                        <option value="dharamshala">Dharamshala</option>
                        <option value="raigarh">Raigarh</option>
                        <option value="dantewada">Dantewada</option>
                        <option value="kishanganj">Kishanganj</option>
                        <option value="jashpur">Jashpur</option>
                        <option value="sarjaapura">Sarjaapura</option>
                        <option value="himachal_bca">Himachal BCA</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="level-filter">Level:</label>
                    <select id="level-filter">
                        <option value="all">All Levels</option>
                        <option value="1">Level 1</option>
                        <option value="2">Level 2</option>
                        <option value="3">Level 3</option>
                        <option value="4">Level 4</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="status-filter">Status:</label>
                    <select id="status-filter">
                        <option value="all">All</option>
                        <option value="available">Available</option>
                        <option value="claimed">Claimed</option>
                    </select>
                </div>
            </div>

            <!-- Rewards by Level -->
            <div class="rewards-container">
                <!-- Level 1 Rewards -->
                <div class="level-section" data-level="1">
                    <h3>üåü Level 1 Rewards</h3>
                    <div class="rewards-grid" id="level-1-rewards">
                        <!-- Rewards will be dynamically loaded here -->
                    </div>
                </div>

                <!-- Level 2 Rewards -->
                <div class="level-section" data-level="2">
                    <h3>‚≠ê Level 2 Rewards</h3>
                    <div class="rewards-grid" id="level-2-rewards">
                        <!-- Rewards will be dynamically loaded here -->
                    </div>
                </div>

                <!-- Level 3 Rewards -->
                <div class="level-section" data-level="3">
                    <h3>üí´ Level 3 Rewards</h3>
                    <div class="rewards-grid" id="level-3-rewards">
                        <!-- Rewards will be dynamically loaded here -->
                    </div>
                </div>

                <!-- Level 4 Rewards -->
                <div class="level-section" data-level="4">
                    <h3>üéØ Level 4 Rewards</h3>
                    <div class="rewards-grid" id="level-4-rewards">
                        <!-- Rewards will be dynamically loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Leaderboard Section -->
    <section id="leaderboard" class="leaderboard-section">
        <div class="container">
            <div class="section-header">
                <h2>üèÜ Campus Leaderboard</h2>
                <p>See how campuses and houses are performing this month</p>
            </div>

            <div class="leaderboard-tabs">
                <button class="tab-button active" data-tab="campus">Campus Rankings</button>
                <button class="tab-button" data-tab="house">House Rankings</button>
            </div>

            <div class="tab-content active" id="campus-tab">
                <div class="leaderboard-table">
                    <div class="table-header">
                        <div class="rank">Rank</div>
                        <div class="name">Campus</div>
                        <div class="points">Points</div>
                        <div class="rewards">Rewards Won</div>
                        <div class="trend">Trend</div>
                    </div>
                    <div class="table-body" id="campus-leaderboard">
                        <!-- Leaderboard data will be loaded here -->
                    </div>
                </div>
            </div>

            <div class="tab-content" id="house-tab">
                <div class="leaderboard-table">
                    <div class="table-header">
                        <div class="rank">Rank</div>
                        <div class="name">House</div>
                        <div class="campus">Campus</div>
                        <div class="points">Points</div>
                        <div class="trend">Trend</div>
                    </div>
                    <div class="table-body" id="house-leaderboard">
                        <!-- House leaderboard data will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Request Rewards Section -->
    <section id="request" class="request-section">
        <div class="container">
            <div class="section-header">
                <h2>üìù Request New Rewards</h2>
                <p>Suggest new rewards for your campus (requires login)</p>
            </div>

            <div class="request-form-container">
                <div class="login-prompt" id="login-prompt">
                    <div class="prompt-content">
                        <i class="fas fa-lock"></i>
                        <h3>Login Required</h3>
                        <p>Please log in to request new rewards for your campus.</p>
                        <button class="btn btn-primary" onclick="window.location.href='login.html'">Login Now</button>
                    </div>
                </div>

                <form class="request-form hidden" id="request-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reward-title">Reward Title *</label>
                            <input type="text" id="reward-title" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="reward-level">Suggested Level *</label>
                            <select id="reward-level" name="level" required>
                                <option value="">Select Level</option>
                                <option value="1">Level 1</option>
                                <option value="2">Level 2</option>
                                <option value="3">Level 3</option>
                                <option value="4">Level 4</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="reward-description">Description *</label>
                        <textarea id="reward-description" name="description" rows="4" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="reward-image">Image URL (optional)</label>
                        <input type="url" id="reward-image" name="image" placeholder="https://example.com/image.jpg">
                    </div>
                    
                    <div class="form-group">
                        <label for="reward-justification">Why this reward? *</label>
                        <textarea id="reward-justification" name="justification" rows="3" required></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> Submit Request
                    </button>
                </form>
            </div>

            <!-- Pending Requests -->
            <div class="pending-requests" id="pending-requests">
                <h3>Your Pending Requests</h3>
                <div class="requests-list" id="requests-list">
                    <!-- User's pending requests will be shown here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Login Modal -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Login to Rewards Dashboard</h3>
                <button class="modal-close" onclick="closeModal('login-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" name="password" required>
                    </div>
                    <div class="form-group">
                        <label for="login-campus">Campus</label>
                        <select id="login-campus" name="campus" required>
                            <option value="">Select Campus</option>
                            <option value="pune">Pune</option>
                            <option value="dharamshala">Dharamshala</option>
                            <option value="raigarh">Raigarh</option>
                            <option value="dantewada">Dantewada</option>
                            <option value="kishanganj">Kishanganj</option>
                            <option value="jashpur">Jashpur</option>
                            <option value="sarjaapura">Sarjaapura</option>
                            <option value="himachal_bca">Himachal BCA</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">Login</button>
                </form>
                <div class="modal-footer">
                    <p>Don't have an account? <a href="login.html">Sign up here</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Reward Detail Modal -->
    <div class="modal" id="reward-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="reward-modal-title">Reward Details</h3>
                <button class="modal-close" onclick="closeModal('reward-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="reward-detail">
                    <div class="reward-image-container">
                        <img id="reward-modal-image" src="" alt="Reward Image">
                    </div>
                    <div class="reward-info">
                        <div class="reward-meta">
                            <span class="reward-level" id="reward-modal-level">Level 1</span>
                            <span class="reward-campus" id="reward-modal-campus">North Campus</span>
                        </div>
                        <p class="reward-description" id="reward-modal-description"></p>
                        <div class="reward-stats">
                            <div class="stat">
                                <i class="fas fa-heart"></i>
                                <span id="reward-modal-likes">0</span> likes
                            </div>
                            <div class="stat">
                                <i class="fas fa-users"></i>
                                <span id="reward-modal-claimed">0</span> claimed
                            </div>
                        </div>
                        <div class="reward-actions">
                            <button class="btn btn-primary" id="claim-reward-btn">
                                <i class="fas fa-gift"></i> Claim Reward
                            </button>
                            <button class="btn btn-secondary" id="like-reward-btn">
                                <i class="fas fa-heart"></i> Like
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div class="modal" id="admin-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Admin Panel</h3>
                <button class="modal-close" onclick="closeModal('admin-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="admin-tabs">
                    <button class="tab-button active" data-tab="rewards-management">Manage Rewards</button>
                    <button class="tab-button" data-tab="pending-requests">Pending Requests</button>
                    <button class="tab-button" data-tab="bulk-operations">Bulk Operations</button>
                    <button class="tab-button" data-tab="analytics">Analytics</button>
                </div>
                
                <div class="tab-content active" id="rewards-management-tab">
                    <div class="admin-section">
                        <h4>Add New Reward</h4>
                        <form id="admin-reward-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="admin-reward-title">Title</label>
                                    <input type="text" id="admin-reward-title" required>
                                </div>
                                <div class="form-group">
                                    <label for="admin-reward-level">Level</label>
                                    <select id="admin-reward-level" required>
                                        <option value="1">Level 1</option>
                                        <option value="2">Level 2</option>
                                        <option value="3">Level 3</option>
                                        <option value="4">Level 4</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="admin-reward-description">Description</label>
                                <textarea id="admin-reward-description" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="admin-reward-image">Image URL</label>
                                <input type="url" id="admin-reward-image">
                            </div>
                            <button type="submit" class="btn btn-primary">Add Reward</button>
                        </form>
                    </div>
                </div>
                
                <div class="tab-content" id="pending-requests-tab">
                    <div class="pending-requests-admin">
                        <h4>Pending Reward Requests</h4>
                        <div id="admin-pending-list">
                            <!-- Pending requests will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="bulk-operations-tab">
                    <div class="bulk-operations-admin">
                        <div class="admin-section">
                            <h4><i class="fas fa-upload"></i> CSV Bulk Upload</h4>
                            <p>Import student points for a specific campus and house. Please select the campus and house, then upload the CSV file. <a href="#" id="download-csv-template">Download template</a></p>
                            <div style="margin-bottom:8px; color:#1976D2; font-size:14px;">
                                <strong>New:</strong> Reward CSV import now supports Google Drive image links!<br>
                                Paste a Google Drive share link (e.g. <code>https://drive.google.com/file/d/FILE_ID/view?usp=sharing</code>) in the Image column. The system will convert it to a direct image link automatically.<br>
                                Direct image URLs (e.g. <code>https://example.com/image.jpg</code>) are also supported.
                            </div>
                            <form id="csv-upload-form">
                                <div class="form-row" style="border:2px dashed #2196F3; background:#e3f2fd; padding:12px; margin-bottom:8px;">
                                    <div class="form-group">
                                        <label for="csv-campus-select">Campus</label>
                                        <select id="csv-campus-select" required>
                                            <option value="">Select Campus</option>
                                            <option value="pune">Pune</option>
                                            <option value="dharamshala">Dharamshala</option>
                                            <option value="raigarh">Raigarh</option>
                                            <option value="dantewada">Dantewada</option>
                                            <option value="kishanganj">Kishanganj</option>
                                            <option value="jashpur">Jashpur</option>
                                            <option value="sarjaapura">Sarjaapura</option>
                                            <option value="himachal_bca">Himachal BCA</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="csv-house-select">House</label>
                                        <select id="csv-house-select" required>
                                            <option value="">Select House</option>
                                            <option value="bageshree">Bageshree House</option>
                                            <option value="bhairav">Bhairav House</option>
                                            <option value="malhar">Malhar House</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="csv-file-input">CSV File</label>
                                        <input type="file" id="csv-file-input" accept=".csv" required />
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary"><i class="fas fa-upload"></i> Upload Points</button>
                                <button type="submit" class="btn btn-primary" id="csv-upload-debug-btn" style="background:#1976D2; border:2px solid #1976D2; color:#fff;"> <i class="fas fa-upload"></i> Upload Points (Debug)</button>
                            </form>
                            <div id="csv-upload-preview" style="margin-top: 16px;"></div>
                            <script>
                            // Debug: Log presence of form and button
                            document.addEventListener('DOMContentLoaded', function() {
                                var form = document.getElementById('csv-upload-form');
                                var btn = document.getElementById('csv-upload-debug-btn');
                                if (form) { console.log('‚úÖ CSV upload form found in DOM'); }
                                else { console.warn('‚ùå CSV upload form NOT found in DOM'); }
                                if (btn) { console.log('‚úÖ CSV upload button found in DOM'); }
                                else { console.warn('‚ùå CSV upload button NOT found in DOM'); }
                            });
                            </script>
                        </div>
                        
                        <div class="admin-section">
                            <h4><i class="fas fa-cogs"></i> Student Point Management</h4>
                            <div class="point-management-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="student-search">Student</label>
                                        <input type="text" id="student-search" placeholder="Search by name or ID">
                                        <div id="student-search-results" class="search-results"></div>
                                    </div>
                                    <div class="form-group">
                                        <label for="point-type">Point Type</label>
                                        <select id="point-type">
                                            <option value="academic">Academic Points</option>
                                            <option value="lifeSkills">Life Skills Points</option>
                                            <option value="attendance">Attendance Bonus (+15)</option>
                                            <option value="placement">Placement Bonus (+15)</option>
                                            <option value="dropout">Dropout Penalty (-15)</option>
                                            <option value="bonus">Other Bonus</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="point-amount">Points</label>
                                        <input type="number" id="point-amount" placeholder="Enter points">
                                    </div>
                                    <div class="form-group">
                                        <label for="point-reason">Reason</label>
                                        <input type="text" id="point-reason" placeholder="Reason for points">
                                    </div>
                                </div>
                                <button type="button" class="btn btn-primary" id="add-points-btn">
                                    <i class="fas fa-plus"></i> Add Points
                                </button>
                            </div>
                        </div>

                        <div class="admin-section">
                            <h4><i class="fas fa-home"></i> House Competition Management</h4>
                            <div class="house-management-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="house-select">House</label>
                                        <select id="house-select">
                                            <option value="">Select House</option>
                                            <option value="bageshree">Bageshree House</option>
                                            <option value="bhairav">Bhairav House</option>
                                            <option value="malhar">Malhar House</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="competition-campus">Campus</label>
                                        <select id="competition-campus">
                                            <option value="">Select Campus</option>
                                            <option value="pune">Pune Campus</option>
                                            <option value="dharamshala">Dharamshala Campus</option>
                                            <option value="raigarh">Raigarh Campus</option>
                                            <option value="dantewada">Dantewada Campus</option>
                                            <option value="kishanganj">Kishanganj Campus</option>
                                            <option value="jashpur">Jashpur Campus</option>
                                            <option value="sarjaapura">Sarjaapura Campus</option>
                                            <option value="himachal-bca">Himachal BCA Campus</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="competition-points">Points</label>
                                        <input type="number" id="competition-points" placeholder="Competition points">
                                    </div>
                                    <div class="form-group">
                                        <label for="competition-name">Competition</label>
                                        <input type="text" id="competition-name" placeholder="Competition name">
                                    </div>
                                </div>
                                <button type="button" class="btn btn-primary" id="add-house-points-btn">
                                    <i class="fas fa-trophy"></i> Add House Points
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="analytics-tab">
                    <div class="analytics-dashboard">
                        <h4>Dashboard Analytics</h4>
                        <div class="analytics-grid">
                            <div class="analytics-card">
                                <h5>Total Rewards</h5>
                                <span class="analytics-number">48</span>
                            </div>
                            <div class="analytics-card">
                                <h5>Active Users</h5>
                                <span class="analytics-number">156</span>
                            </div>
                            <div class="analytics-card">
                                <h5>Pending Requests</h5>
                                <span class="analytics-number">12</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4><i class="fas fa-trophy"></i> Rewards Dashboard</h4>
                    <p>Empowering campus communities through recognition and rewards.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#dashboard">Dashboard</a></li>
                        <li><a href="#rewards">Rewards</a></li>
                        <li><a href="#leaderboard">Leaderboard</a></li>
                        <li><a href="#request">Request Rewards</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Campus Network</h4>
                    <ul>
                        <li><a href="#pune">Pune</a></li>
                        <li><a href="#dharamshala">Dharamshala</a></li>
                        <li><a href="#raigarh">Raigarh</a></li>
                        <li><a href="#dantewada">Dantewada</a></li>
                        <li><a href="#kishanganj">Kishanganj</a></li>
                        <li><a href="#jashpur">Jashpur</a></li>
                        <li><a href="#sarjaapura">Sarjaapura</a></li>
                        <li><a href="#himachal_bca">Himachal BCA</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="#help">Help Center</a></li>
                        <li><a href="#contact">Contact Us</a></li>
                        <li><a href="admin.html">Admin Login</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Campus Rewards Dashboard. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Firebase Configuration -->
    <script src="js/firebase-config.js"></script>

    <script src="js/firebase-service.js"></script>
    <script src="js/csv-upload.js"></script>
    
    <!-- Main Application Scripts -->
    <script src="js/script.js"></script>
    <script src="js/rewards.js"></script>
    <script src="js/admin.js"></script>
    
    <!-- Authentication Integration -->
    <script>
        // Global variables for authentication state
        let currentUser = null;
        let primaryDbConnected = false;


        // Initialize authentication state checking
        function initializeAuth() {
            // Check for stored user from login
            const storedUser = sessionStorage.getItem('firebaseUser');
            
            if (storedUser) {
                try {
                    currentUser = JSON.parse(storedUser);
                    console.log('‚úÖ Found authenticated user:', currentUser.email || 'Anonymous');
                    updateAuthUI();
                    testDatabaseConnections();
                } catch (error) {
                    console.error('Error parsing stored user:', error);
                    showPublicAccess();
                }
            } else {
                console.log('‚ÑπÔ∏è No authenticated user found - public access only');
                showPublicAccess();
            }
        }

        async function updateAuthUI() {
            const authBanner = document.getElementById('auth-banner');
            const userInfo = document.getElementById('auth-user-info');
            const guestInfo = document.getElementById('auth-guest-info');
            const loginLink = document.getElementById('login-link');
            const logoutBtn = document.getElementById('logout-btn');

            if (currentUser) {
                // User is logged in
                authBanner.classList.add('logged-in');
                userInfo.style.display = 'flex';
                guestInfo.style.display = 'none';
                loginLink.style.display = 'none';
                logoutBtn.style.display = 'inline-flex';

                // Update user info
                const userAvatar = document.getElementById('user-avatar');
                const userName = document.getElementById('user-name');
                
                if (currentUser.photoURL) {
                    userAvatar.innerHTML = `<img src="${currentUser.photoURL}" style="width: 100%; height: 100%; border-radius: 50%;">`;
                } else {
                    userAvatar.innerHTML = '<i class="fas fa-user"></i>';
                }
                
                userName.textContent = currentUser.displayName || currentUser.email || 'User';
            } else {
                // No user logged in
                authBanner.classList.remove('logged-in');
                userInfo.style.display = 'none';
                guestInfo.style.display = 'block';
                loginLink.style.display = 'inline-flex';
                logoutBtn.style.display = 'none';
            }
        }


        // Only test primary database connection
        async function testDatabaseConnections() {
            const primaryIndicator = document.getElementById('primary-db');
            try {
                if (window.FirebaseConnections && window.FirebaseConnections.primary.db) {
                    await window.FirebaseConnections.primary.db.collection('rewards').limit(1).get();
                    primaryDbConnected = true;
                    primaryIndicator.classList.add('connected');
                    primaryIndicator.textContent = 'Primary ‚úì';
                    console.log('‚úÖ Primary database connected');
                }
            } catch (error) {
                primaryIndicator.textContent = 'Primary ‚úó';
                console.warn('‚ö†Ô∏è Primary database connection failed:', error);
            }
        }

        function showPublicAccess() {
            const primaryIndicator = document.getElementById('primary-db');
            // Show primary database as available
            primaryIndicator.textContent = 'Primary ‚úì';
            primaryIndicator.classList.add('connected');
            console.log('‚ÑπÔ∏è Public access mode - primary database available');
        }

        function signOut() {
            // Clear stored user data
            sessionStorage.removeItem('firebaseUser');
            currentUser = null;
            
            console.log('‚úÖ User signed out');
            location.reload(); // Refresh to reset state
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üî• Authentication system initializing...');
            
            // Wait a bit for Firebase to load
            setTimeout(() => {
                initializeAuth();
            }, 1000);
        });

        // Export functions for use by other scripts
        window.getCurrentUser = () => currentUser;
        window.isPrimaryDbConnected = () => primaryDbConnected;

        window.signOut = signOut;
    </script>
</body>
</html>
